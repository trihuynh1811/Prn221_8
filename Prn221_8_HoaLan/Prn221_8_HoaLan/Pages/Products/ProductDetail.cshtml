@page
@model Prn221_8_HoaLan.Pages.Products.ProductDetailModel
@{
    Layout = "_Layout";
}
@{
    var fullName = "";
    var session = HttpContext.Session;
    User user = Prn221_8_HoaLan.SessionExtensions.Get<User>(session, "User");
    if (user != null)
    {
        fullName = user.FirstName + " " + user.LastName;
        ViewBag.Role = user.Role;
    }
}
<div>
    <span>Name </span>
    <span>@Model.p.ProductName</span>
    <br />
    <span>Description </span>
    <span>@Model.p.Description</span>
    <br />
    <span>Quantity </span>
    <span>@Model.p.Quantity</span>
    <br />
    <span>Price </span>
    <span>@Model.p.Price</span>
    <div>
        <img style="width: 300px; height: 300px; object-fit: contain;" src="@Model.p.Image" />
    </div>
    <div>
        <button onclick="AddToCart(@Model.p.ProductId)">Buy</button>
    </div>
    
</div>
<script>
    async function AddToCart(pid) {
        let data = {
            id: pid
        }
        const res = await fetch('?handler=AddToCart', {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })

        if (res.status === 200) {
            console.log(res.json())
        }
        if(res.status === 400){
            res.json().then(function(res){
                alert(res)
            }).catch(function(e) {
                alert(e)
            })
            
        }
    }

</script>